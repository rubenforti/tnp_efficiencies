import ROOT
from utilities.base_lib import bin_dictionary, binning
from utilities.plot_utils import style_settings
chi2_list = [79.93094107623438, 83.60415805224875, 68.68404663027377, 84.80561882008988, 66.7216106126175, 111.66185484394737, 84.29961232905316, 82.61395980591988, 78.75438534982095, 70.50331221224133, 90.88726764010698, 76.2868306999535, 118.7006312129306, 101.25183581824967, 94.96544578330213, 82.61792390613482, 76.10061437760487, 51.6224538131446, 77.48032893001437, 77.13104804234354, 74.42613187630559, 93.96915579360757, 77.53397243614245, 72.13214148532097, 72.03859838133758, 71.53498674864659, 80.21423607557972, 63.895931270039, 83.03315382202709, 69.69575068791164, 76.30204134198175, 92.38392509995083, 74.3638863069209, 75.90809601508045, 110.9744700073752, 116.49498216988286, 70.98243762665243, 81.6842429571434, 81.67113783681634, 101.01013882260304, 103.57234225961656, 70.25272827870867, 72.53867183139118, 91.05387471949143, 75.05333041682889, 86.1205962988397, 80.17256219334558, 101.53688442661769, 62.56279464352792, 98.45577688963795, 84.22719920220925, 78.02290822618511, 77.83771042424564, 76.13570894105214, 79.42071146485387, 61.865745322824296, 48.05079393385677, 90.97190611069072, 74.3423097476566, 82.56177866886651, 66.21112036725481, 92.566588886908, 87.53972688474641, 76.63690105278192, 78.38348864863747, 86.0604981853453, 73.39214652414739, 101.36534194707656, 92.37160745019082, 87.53130967638526, 73.93803194582154, 83.10774626144666, 84.05602081137067, 59.64059586129247, 68.56521059876354, 66.89189864605032, 88.24103662601192, 74.88202412834289, 83.3992980601829, 70.99607336759209, 87.07204180336021, 61.72917729347682, 67.82332306429271, 76.52649847019075, 101.49421860756456, 93.47568509038865, 85.86050340629163, 77.77033473050324, 90.5809176949524, 80.11030912080469, 68.57050899105207, 78.30498418035768, 110.5786101127012, 71.89718631248388, 68.16142632402693, 80.29502174271829, 72.81313934155003, 81.72236096865186, 85.44381629153861, 91.83045590690853, 77.30435372071304, 85.87024500779842, 69.44213945531283, 87.19575226613142, 97.72114556503038, 73.11442145605133, 61.63063248466426, 119.16290001717618, 77.69935458026885, 63.98872248392672, 55.60675399351476, 75.91844931013111, 82.76011083283788, 112.12659501100802, 77.33222783867859, 96.50782990794369, 99.78537203649876, 65.33936637176939, 84.74016104249391, 79.71601894182186, 101.37518426630118, 70.07355233283829, 92.16859811427503, 87.22011782443406, 87.98630370348747, 59.64959958178497, 73.07948530443264, 94.3766677110375, 67.25709211010417, 81.61628620780084, 89.52700746035771, 84.01760005979713, 87.78651359965352, 99.28353991336712, 87.61287033380404, 71.60712331650666, 90.22936476106815, 85.42243393663534, 82.10014499676879, 78.6127354788037, 91.26216883657662, 61.77998584531747, 89.3734762698216, 90.21331836463446, 93.78835082996105, 83.83311351124962, 70.25481042608715, 88.9531091427672, 97.44089142191523, 67.26283258861355, 90.15055076778674, 82.7000249184398, 88.69580549226839, 88.50314747896323, 82.87903353077823, 72.92468803350346, 62.20117404780126, 145.70807645660307, 60.22995262411132, 77.83443123958273, 134.31900821380873, 99.07519403884805, 76.25392306526419, 83.05276862582059, 82.19757186600646, 72.71675156045885, 112.41736567492465, 68.38656795283885, 92.2663528562864, 73.84789853540619, 75.97477802215798, 82.35797890542472, 78.2342490695911, 103.53876868292423, 109.12764261195298, 108.82702752719524, 91.44643591247268, 70.52586738220316, 78.0723740379658, 106.79747412195456, 81.74406281754847, 77.28080747715262, 95.01465369915616, 62.34972889730079, 87.20687018193121, 82.76075925143948, 122.13304632831301, 91.2473686386799, 89.94524198769922, 95.07085524255157, 87.64970676862708, 118.71568043010359]
ndof_list = [77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 75.0, 76.0, 77.0, 77.0, 74.0, 76.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 76.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 75.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 76.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 75.0, 76.0, 76.0, 73.0, 76.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 74.0, 77.0, 77.0, 77.0, 77.0, 76.0, 74.0, 77.0, 77.0, 77.0, 74.0, 73.0, 77.0, 77.0, 75.0, 75.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 77.0, 76.0, 76.0, 75.0, 76.0, 77.0, 77.0, 77.0, 74.0, 76.0, 76.0, 77.0, 76.0, 77.0, 74.0, 72.0, 75.0, 73.0, 72.0, 76.0, 76.0, 77.0, 77.0, 77.0, 76.0, 76.0, 77.0, 77.0, 77.0, 76.0, 72.0, 75.0, 77.0, 77.0, 76.0, 70.0, 62.0, 77.0, 77.0, 70.0, 73.0, 77.0, 77.0, 77.0, 74.0, 73.0, 76.0, 77.0, 77.0, 76.0, 75.0, 76.0, 77.0, 77.0, 77.0, 76.0, 75.0, 74.0, 74.0, 72.0, 73.0, 73.0]


folder_path = "/scratch/rforti/tnp_efficiencies_results/tracking/fit_background_SameCharge"

h2d_chi2norm = ROOT.TH2D("h2d_chi2norm", "h2d_chi2norm",
                         len(binning("pt_tracking"))-1,  binning("pt_tracking"), 
                         len(binning("eta"))-1, binning("eta"))

h2d_nsigma = ROOT.TH2D("h2d_nsigma", "h2d_nsigma",
                        len(binning("pt_tracking"))-1,  binning("pt_tracking"), 
                        len(binning("eta"))-1, binning("eta"))

h_chi2norm = ROOT.TH1D("h_chi2norm", "h_chi2norm", 21, 0.5, 2)
h_nsigma = ROOT.TH1D("h_nsigma", "h_nsigma", 21, -5, 5)


for bin_key, [gl_idx, pt_idx, eta_idx] in bin_dictionary("pt_tracking", "eta").items():
    chi2 = chi2_list[gl_idx-1]
    ndof = ndof_list[gl_idx-1]
    h_chi2norm.Fill(chi2/ndof)
    h_nsigma.Fill((chi2-ndof)/((2*ndof)**0.5))
    h2d_chi2norm.SetBinContent(pt_idx, eta_idx, chi2/ndof)
    h2d_nsigma.SetBinContent(pt_idx, eta_idx, (chi2-ndof)/((2*ndof)**0.5))

style_settings()

c1 = ROOT.TCanvas("c1", "c1", 800, 600)
c1.cd()

h2d_chi2norm.GetXaxis().SetTitle("p_{T} [GeV]")
h2d_chi2norm.GetYaxis().SetTitle("#eta")
h2d_chi2norm.GetYaxis().SetTitleOffset(0.8)
h2d_chi2norm.GetZaxis().SetTitle("#chi^{2}/ndof")
h2d_chi2norm.GetZaxis().SetTitleOffset(1.2)
h2d_chi2norm.SetTitle("#chi^{2}/ndof")
h2d_chi2norm.Draw("colz")

c1.SaveAs(folder_path+"/chi2norm_map.png")

c2 = ROOT.TCanvas("c2", "c2", 800, 600)
c2.cd()

h2d_nsigma.GetXaxis().SetTitle("p_{T} [GeV]")
h2d_nsigma.GetYaxis().SetTitle("#eta")
h2d_nsigma.GetYaxis().SetTitleOffset(0.8)
h2d_nsigma.GetZaxis().SetTitle("N_{#sigma}")
h2d_nsigma.GetZaxis().SetTitleOffset(1.2)
h2d_nsigma.SetTitle("(#chi^{2}-ndof)/#sqrt{2*ndof}")
h2d_nsigma.Draw("colz")

c2.SaveAs(folder_path+"/nsigma_map.png")


ROOT.gStyle.SetOptStat("emruo")
ROOT.gStyle.SetOptStat("emruo")
ROOT.gStyle.SetStatBorderSize(2)
ROOT.gStyle.SetStatX(0.9)
ROOT.gStyle.SetStatY(0.95)

c3 = ROOT.TCanvas("c3", "c3", 800, 600)
c3.cd()

h_chi2norm.GetXaxis().SetTitle("#chi^{2}/ndof")
h_chi2norm.GetXaxis().SetTitleOffset(1.2)
h_chi2norm.GetXaxis().SetTitleSize(0.04)
h_chi2norm.GetXaxis().SetLabelSize(0.025)
h_chi2norm.GetYaxis().SetTitle("Events")
h_chi2norm.GetYaxis().SetTitleOffset(1.25)
h_chi2norm.GetYaxis().SetTitleSize(0.04)
h_chi2norm.GetYaxis().SetLabelSize(0.025)

h_chi2norm.Draw()
c3.SaveAs(folder_path+"/chi2norm.png")

c4 = ROOT.TCanvas("c4", "c4", 800, 600)
c4.cd()

h_nsigma.GetXaxis().SetTitle("(#chi^{2}-ndof)/#sqrt{2*ndof}")
h_nsigma.GetXaxis().SetTitleOffset(1.2)
h_nsigma.GetXaxis().SetTitleSize(0.04)
h_nsigma.GetXaxis().SetLabelSize(0.025)
h_nsigma.GetYaxis().SetTitle("Events")
h_nsigma.GetYaxis().SetTitleOffset(1.25)
h_nsigma.GetYaxis().SetTitleSize(0.04)
h_nsigma.GetYaxis().SetLabelSize(0.025)

h_nsigma.Draw()
c4.SaveAs(folder_path+"/nsigma.png")


